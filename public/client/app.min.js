!function(){angular.module("app",["ui.router","ngResource","LocalStorageModule","ngMessages","pascalprecht.translate","ngSanitize","ui.bootstrap"]).run(["$rootScope","Auth","Router","api","$state","CONSTANT",function(e,a,n,t,u,o){e.$state=u,e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.activate()}),e.loadUrl=function(e){return o.API+e},e.joinClass=function(e,a){var n={};return _.each(e,function(e,t){e.name&&e.value&&(n[e.name]=e.value),"selected"===e.name&&(n[e.name]=a)}),n},e.joinStyles=function(a){var n={};return _.each(a,function(a,t){if(a.name){var u="";a.name.indexOf("image")>=0?a.value&&(u='url("'+e.loadUrl(a.value.attributes.image.url)+'")'):u=a.value,n[a.name]=u}}),n}}])}();
!function(){angular.module("app").constant("CONSTANT",{API:"http://localhost:3000",HTML5:!0})}();
!function(){angular.module("app").config(["$translateProvider",function(e){e.preferredLanguage("en"),e.useSanitizeValueStrategy("sanitize")}])}();
!function(){angular.module("app").config(["$provide","$httpProvider",function(e,t){e.factory("HttpInterceptor",["$q","Storage",function(e,t){return{request:function(n){var r=t.getToken();return r&&(n.headers["access-token"]=r["access-token"],n.headers.client=r.client,n.headers.uid=r.uid),n||e.when(n)},response:function(e){var n=e.headers();return n["access-token"]&&t.setToken(n),e}}}]),t.interceptors.push("HttpInterceptor")}])}();
!function(){angular.module("app").config(["$stateProvider","$urlRouterProvider","$locationProvider","CONSTANT",function(e,t,o,l){e.state("app",{abstract:!0,url:"",views:{}}).state("app.login",{url:"/:sluck/login",views:{"content@":{templateUrl:"pages/nodes.html",controller:"Login"}}}).state("app.notFound",{url:"/not-found",views:{"content@":{templateUrl:"pages/not-found/index.html"}}}).state("app.home",{requiresAuth:!0,url:"/:sluck",views:{"content@":{templateUrl:"pages/nodes.html",controller:"Home"}}}).state("app.page",{requiresAuth:!0,url:"/:sluck/:pageSluck",views:{"content@":{templateUrl:"pages/nodes.html",controller:"Page"}}}),t.otherwise("/not-found"),l.HTML5&&o.html5Mode(!0)}])}();
!function(){angular.module("app").config(["localStorageServiceProvider",function(e){e.setPrefix("clisss_client").setStorageType("sessionStorage").setNotify(!0,!0)}])}();
!function(){angular.module("app").directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,o,n,r){r.$validators.compareTo=function(o){return o==e.otherModelValue},e.$watch("otherModelValue",function(){r.$validate()})}}})}();
!function(){angular.module("app").directive("emailExists",["api","Dialog",function(i,a){return{require:"ngModel",link:function(t,e,n,l){var o=!0;l.$validators.emailExists=function(){return o},t.$watch(n.ngModel,function(t){l.$valid?i.v1.auth().checkEmail({email:t}).$promise.then(function(i){o=i.data,l.$validate()}).catch(function(i){o=!1,l.$validate(),a.showAlertDialog("title.addNewUser",i.message,"btn.ok",null)}):o=!0})}}}])}();
!function(){angular.module("app").factory("api",["$resource","CONSTANT",function(e,t){return{auth:function(){return e(t.API+"/user/auth/sign_in",{},{sign_out:{method:"DELETE",url:t.API+"/user/auth/sign_out"}})},project:function(){return e(t.API+"/api/v1/user/projects/:projectId/pages/:pageId",{projectId:"@projectId",pageId:"@pageId"},{destroy:{method:"DELETE"},update:{method:"PUT"}})},createData:function(){return e(t.API+"/api/v1/user/projects/:projectId/pages/:pageId/create_or_update",{projectId:"@projectId",pageId:"@pageId"})},projectExists:function(){return e(t.API+"/api/v1/user/projects/:projectName",{projectName:"@projectName"})}}}])}();
!function(){angular.module("app").factory("Auth",["Storage",function(e){return{clearAuth:function(){e.removeToken(),e.removeUser()},setUser:function(n){e.setUser(n)},isLoggedIn:function(){return e.getToken()}}}])}();
!function(){angular.module("app").factory("Page",["api","Storage","Router","$q","Auth",function(e,t,n,r,o){var c={};return c.login=function(t){var n=r.defer();return e.auth().save(t).$promise.then(function(e){o.setUser(e.data),n.resolve(e)}).catch(function(e){n.reject(e)}),n.promise},c.signout=function(){var t=r.defer();return e.auth().sign_out().$promise.then(function(e){o.clearAuth(),c.clearNextPage(),t.resolve(e)}).catch(function(e){t.reject(e)}),t.promise},c.loadPage=function(t,n){var o=r.defer();return e.project().get({projectId:t,pageId:n}).$promise.then(function(e){var t=e.data;o.resolve(t)}).catch(function(e){o.reject(e)}),o.promise},c.loadInfo=function(t){var n=r.defer();return e.projectExists().get({projectName:t}).$promise.then(function(e){c.setProjectId(e.data.id),n.resolve(angular.fromJson(e.data.relationships.pages.data.layout))}).catch(function(e){n.reject(e)}),n.promise},c.getProjectId=function(){return t.getItem("_projectId")},c.setProjectId=function(e){return t.setItem("_projectId",e)},c.getNextPage=function(){return t.getItem("_next")},c.setNextPage=function(e){return t.setItem("_next",e)},c.clearNextPage=function(){return t.removeItem("_next")},c.getItem=function(e){t.getItem(e)},c.setItem=function(e,n){t.setItem(e,n)},c.recursiveFunction=function(e,t){_.each(e,function(e){is.array(e.children)&&e.children.length>0?c.recursiveFunction(e.children,t):is.array(e)?c.recursiveFunction(e,t):is.object(e)&&"input"===e.type&&(t[e.model]=e.model)})},c}])}();
!function(){angular.module("app").factory("Router",["$state","$timeout",function(n,o){var t={};return t.changeView=function(t,e,a){o(function(){n.go(t,e,a)},0)},t.toLogin=function(n,o){t.changeView("app.login",n,o)},t.toNotFound=function(n,o){t.changeView("app.notFound",n,o)},t.toHome=function(n,o){t.changeView("app.home",n,o)},t.toPage=function(n,o){t.changeView("app.page",n,o)},t}])}();
!function(){angular.module("app").factory("Storage",["localStorageService",function(e){var n={},t=function(n,t){e.set(n,angular.toJson(t))},o=function(n){return angular.fromJson(e.get(n))},r=function(n){e.remove(n)},u=function(){e.clearAll()};return n.setItem=function(e,n){t(e,n)},n.getItem=function(e){return o(e)},n.removeItem=function(e){r(e)},n.clearAll=function(){u()},n.setToken=function(e){t("token",e)},n.getToken=function(){return o("token")},n.removeToken=function(){r("token")},n.setUser=function(e){t("user",e)},n.getUser=function(){return o("user")},n.removeUser=function(){r("user")},n.setPages=function(e){t("pages",e)},n.getPages=function(){return o("pages")},n.removePages=function(){r("pages")},n.setReset=function(){t("reset",!0)},n.getReset=function(){return o("reset")},n.removeReset=function(){r("reset")},n}])}();
!function(){angular.module("app").filter("moment",function(){return function(n,t){var o=void 0;return n&&(o=moment(n,t).format(t)),o}})}();
!function(){angular.module("app").config(["$translateProvider",function(e){e.translations("en",{titles:{pages:"pages",components:"components"},buttons:{signIn:"sign in",create:"create",createNew:"create new",update:"update",delete:"delete",more:"more",add:"add",addNew:"add new",back:"back",copy:"copy",clear:"clear"},error:{pattern:"pattern incorrect",email:"Please input a valid email.",password:"your password must be at least 8 characters.",mismatch:"your confirm password is not match with password.",require:"Please input this field"}})}])}();
!function(){angular.module("app").controller("Home",["$scope","$stateParams","Auth","Router","Page",function(e,a,o,t,g){var u=a.sluck;if(o.isLoggedIn()){var c=g.getNextPage();c?t.toPage({sluck:c.projectName,pageSluck:c.pageName}):t.toLogin({sluck:u})}else t.toLogin({sluck:u})}])}();
!function(){angular.module("app").controller("Login",["$scope","api","Auth","Router","$stateParams","Page",function(e,o,t,n,a,c){var u=a.sluck;c.loadInfo(u).then(function(o){e.layout=o}).catch(function(e){console.log(e),n.toNotFound()}),e.exec=function(o){var t={};if(c.recursiveFunction(e.layout.children,t),e.user={},_.each(t,function(o){var t=o.split(".").pop();e.user[t]=document.getElementsByName(o)[0].value}),"login"==o.action.type&&("alert"===o.action.todoTrue.type&&swal("Success!",o.action.todoTrue.data,"success"),"link"===o.action.todoTrue.type)){var a=o.action.todoTrue.data,l=c.getProjectId();c.login(e.user).then(function(e){return c.loadPage(l,a)}).then(function(e){c.setNextPage({projectName:u,projectId:l,pageId:a,pageName:e.sluck}),n.toPage({sluck:u,pageSluck:e.sluck})}).catch(function(e){console.log(e)})}}}])}();
!function(){angular.module("app").controller("Page",["$scope","api","Auth","Router","$stateParams","Page",function(t,o,a,e,n,c){var u=n.sluck,r=n.pageSluck,l=[];if(t.projectID=0,t.pageID=0,t.listDataRow=[],!a.isLoggedIn())return e.toLogin({sluck:u});var i=c.getNextPage();if(!i||i.projectName!==u||i.pageName!==r)return e.toNotFound();t.projectID=parseInt(i.projectId),t.pageID=i.pageId,c.loadPage(i.projectId,i.pageId).then(function(o){t.layout=angular.fromJson(o.layout),_.each(t.layout.children,function(t){d(t)}),s(l,o.ds.db)}).catch(function(t){e.toNotFound()});var d=function(t){Array.isArray(t.children)?t.hasOwnProperty("type")?(l.push(t),angular.forEach(t.children,function(t){d(t)})):angular.forEach(t.children,function(t){d(t)}):l.push(t)},s=function(o,a){_.each(o,function(o){"table"===o.type&&(t.dataRows=a[o.data.table],console.log(t.dataRows))})},f=function(a){var n=Object.keys(a.action.todoTrue.data.rows[0]);_.each(n,function(o){var e="@DB."+a.action.data.tableToCheck+"."+o;if(1===document.getElementsByName(e).length){var n=document.getElementsByName(e)[0].value;t.valuePostDB[o]={column_id:a.action.todoTrue.data.rows[0][o].column_id,value:n}}}),t.valuePostDB.table_id=a.action.todoTrue.data.rows[0].table_id,a.action.todoTrue.data.rows[0]=t.valuePostDB,o.createData().save({projectId:t.projectID,pageId:t.pageID,rows:a.action.todoTrue.data.rows}).$promise.then(function(){swal("Success!","Created Successfully","success"),c.loadPage(t.projectID,t.pageID).then(function(o){_.each(t.layout.children,function(t){d(t)}),s(l,o.ds.db)}).catch(function(){e.toNotFound()}),"link"===a.action.todoTrue.afterPostData.type&&c.loadPage(t.projectID,a.action.todoTrue.afterPostData.data).then(function(o){t.layout=angular.fromJson(o.layout),_.each(t.layout.children,function(t){d(t)}),s(l,o.ds.db)}).catch(function(){e.toNotFound()})}).catch(function(t){})},p=function(o){t.valueInput={},t.valuePostDB={};var a=o.action.data.columnToCheck,n=Object.keys(o.action.data.columnCodition);_.each(n,function(a){var e="@DB."+o.action.data.tableToCheck+"."+a;if(1===document.getElementsByName(e).length){var n=document.getElementsByName(e)[0].value;t.valueInput[a]=n}}),jsonLogic.apply(a,t.valueInput)?("post"===o.action.todoTrue.type&&f(o),"alert"===o.action.todoTrue.type&&swal("Success!",o.action.todoTrue.data,"success"),"link"===o.action.todoTrue.type&&c.loadPage(t.projectID,o.action.todoTrue.data).then(function(o){t.layout=angular.fromJson(o.layout),_.each(t.layout.children,function(t){d(t)}),s(l,o.ds.db)}).catch(function(){e.toNotFound()})):("alert"===o.action.todoFalse.type&&swal("Error!",o.action.todoFalse.data,"error"),"link"===o.action.todoFalse.type&&c.loadPage(t.projectID,o.action.todoFalse.data).then(function(o){t.layout=angular.fromJson(o.layout),_.each(t.layout.children,function(t){d(t)}),s(l,o.ds.db)}).catch(function(){e.toNotFound()}))};t.exec=function(t){switch(t.action.type){case"logout":c.signout().then(function(){e.toLogin({sluck:u})}).catch(function(t){swal("Error!",angular.toJson(t),"error")});break;case"actionFlow":p(t)}}}])}();